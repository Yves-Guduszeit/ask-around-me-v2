(function(t){function e(e){for(var a,i,r=e[0],l=e[1],c=e[2],d=0,h=[];d<r.length;d++)i=r[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&h.push(o[i][0]),o[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(h.length)h.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],a=!0,r=1;r<s.length;r++){var l=s[r];0!==o[l]&&(a=!1)}a&&(n.splice(e--,1),t=i(i.s=s[0]))}return t}var a={},o={app:0},n=[];function i(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=a,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;n.push([1,"chunk-vendors"]),s()})({0:function(t,e){},1:function(t,e,s){t.exports=s("56d7")},10:function(t,e){},11:function(t,e){},12:function(t,e){},13:function(t,e){},14:function(t,e){},15:function(t,e){},16:function(t,e){},17:function(t,e){},18:function(t,e){},19:function(t,e){},2:function(t,e){},20:function(t,e){},21:function(t,e){},3:function(t,e){},4:function(t,e){},4678:function(t,e,s){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function o(t){var e=n(t);return s(e)}function n(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}o.keys=function(){return Object.keys(a)},o.resolve=n,t.exports=o,o.id="4678"},"48ba":function(t,e,s){t.exports=s.p+"img/overview.6cc73c5b.jpg"},5:function(t,e){},"52dd":function(t,e,s){"use strict";const{S2Cell:a,S2LatLng:o}=s("b1c9"),n=(t,e,s)=>{const n=(t,e)=>{const s=o.fromDegrees(t,e),n=a.fromLatLng(s),i=n.id;return i.id},i=(t,e)=>{t.lessThan(0)&&e++;const s=t.toString(10),a=Math.pow(10,s.length-e);return t.divide(a)},r=n(t,e),l=i(r,s);return l.toString(10)};t.exports={getGeoHashCell:n}},"56d7":function(t,e,s){"use strict";s.r(e),s.d(e,"bus",(function(){return Tt}));s("14d9");var a=s("2b0e"),o=s("755e"),n=s("7496"),i=s("40dc"),r=s("8336"),l=s("a523"),c=s("a75b"),u=s("132d"),d=s("adda"),h=s("2fa4"),g=function(){var t=this,e=t._self._c;return e(n["a"],[e(i["a"],{attrs:{app:"",color:"primary",dark:""}},[e("div",{staticClass:"d-flex align-center"},[e(d["a"],{staticClass:"shrink mr-2",attrs:{alt:"Ask Around Me",contain:"",src:s("d23c"),transition:"scale-transition",width:"160"}})],1),e(h["a"]),t.$auth.loading?t._e():e("div",[t.$auth.isAuthenticated?t._e():e(r["a"],{attrs:{text:""},on:{click:t.login}},[e("span",{staticClass:"mr-2"},[t._v("Log in")]),e(u["a"],[t._v("mdi-account-circle")])],1),t.$auth.isAuthenticated?e(r["a"],{attrs:{text:""},on:{click:t.logout}},[e("span",{staticClass:"mr-2"},[t._v("Log out")]),e(u["a"],[t._v("mdi-account-arrow-right")])],1):t._e()],1)],1),e(c["a"],[e(l["a"],{staticClass:"pa-0 ma-0"},[t.authReady?e("router-view"):t._e()],1)],1),e("iot")],1)},p=[],f={name:"App",data:function(){return{authReady:!1}},created(){Tt.$on("loaded",async()=>{console.log("Auth loaded"),this.$store.commit("setInitialized",!0),this.authReady=!0})},methods:{login(){this.$auth.loginWithRedirect()},logout(){this.$auth.logout({returnTo:window.location.origin})}}},m=f,b=s("2877"),y=Object(b["a"])(m,g,p,!1,null,null,null),j=y.exports,k=s("f309");a["a"].use(k["a"]);var v=new k["a"]({}),w=s("8c4f"),C=s("b0af"),_=s("99d9"),q=s("4bd4"),$=s("b974"),z=s("8654"),x=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e(l["a"],[e(C["a"],{staticClass:"ma-2"},[e(_["d"],{staticClass:"headline"},[t._v("Ask Around")]),e(_["b"],[t._v("Enter a question to ask users around you.")]),e(q["a"],{ref:"form",staticClass:"ma-4",attrs:{"lazy-validation":t.lazy},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[e(z["a"],{attrs:{counter:100,rules:t.questionRules,label:"Question",required:""},model:{value:t.question,callback:function(e){t.question=e},expression:"question"}}),e($["a"],{attrs:{items:t.items,rules:[t=>!!t||"Question type is required"],label:"Question type",required:""},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}}),e(h["a"]),e(_["a"],[e(h["a"]),e(r["a"],{staticClass:"mr-4",attrs:{disabled:!t.valid,color:"success",text:""},on:{click:t.saveQuestion}},[t._v("Submit")]),e(r["a"],{staticClass:"mr-4",attrs:{color:"error",text:""},on:{click:t.reset}},[t._v("Cancel")])],1)],1)],1)],1)],1)},A=[],S=s("bc3a"),I=s.n(S),O={name:"AskView",data:()=>({valid:!0,question:"",questionRules:[t=>!!t||"Question is required",t=>t&&t.length<=100||"Question must be less than 100 characters"],type:null,items:["Star rating","Geo rating"],lazy:!1}),methods:{validate(){this.$refs.form.validate()},reset(){this.$refs.form.reset(),this.$router.push("/")},async saveQuestion(){const t=await this.$auth.getTokenSilently(),e=this.$APIurl+"/questions",s={question:this.question,type:this.type,position:this.$store.getters.getPosition};console.log("URL: ",e),console.log("Payload: ",s);try{const{data:a}=await I.a.post(e,s,{headers:{Authorization:"Bearer "+t}});console.log("Result: ",a)}catch(a){console.error("Error: ",a)}this.reset()}}},L=O,R=Object(b["a"])(L,x,A,!1,null,null,null),T=R.exports,P=s("da13"),M=s("8270"),K=s("5d23"),Q=s("490a"),D=function(){var t=this,e=t._self._c;return e(l["a"],{staticClass:"pa-0 ma-0"},[t.$auth.isAuthenticated?t._e():e("div",{attrs:{id:"unauth-view"}},[e(C["a"],{staticClass:"ma-2"},[e(P["a"],[e(M["a"],{attrs:{color:"grey"}}),e(K["a"],[e(K["c"],{staticClass:"headline"},[t._v("Welcome!")]),e(K["b"],[t._v("Share local knowledge")])],1)],1),e(d["a"],{attrs:{src:s("48ba"),height:"194"}}),e(_["c"],[t._v(" Who serves the best coffee? Where's the best local park? Get the answers to these questions and more from a local audience! ")]),e(_["a"],[e(r["a"],{attrs:{text:"",color:"orange",href:"https://bit.ly/askaroundme",target:"_blank"}},[t._v(" Learn more ")]),e(r["a"],{attrs:{text:"",color:"orange",href:"https://github.com/aws-samples/ask-around-me/",target:"_blank"}},[t._v(" GitHub ")]),e(h["a"])],1)],1)],1),t.$auth.isAuthenticated?e(l["a"],{staticClass:"pa-0 ma-0",attrs:{id:"auth-view"}},[e("GmapMap",{staticStyle:{width:"100%",height:"300px"},attrs:{center:{lat:this.currentLat,lng:this.currentLng},zoom:7,"map-type-id":"roadmap",options:{zoomControl:!0,zoom:11,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUI:!1}}},[t._l(t.questions,(function(s,a){return e("GmapMarker",{key:a,attrs:{position:{lat:s.latitude,lng:s.longitude},clickable:!1,draggable:!1},on:{click:function(e){t.center=s.position}}})})),e("GmapCircle",{attrs:{center:{lat:t.currentLat,lng:t.currentLng},radius:8e3,options:{fillColor:"blue",fillOpacity:.1,strokeColor:"#0000FF",strokeOpacity:.2,strokeWeight:5}}})],2)],1):t._e(),t.$auth.isAuthenticated&&t.loading?e(l["a"],[e("div",{staticClass:"text-center"},[e(Q["a"],{attrs:{size:50,color:"orange",indeterminate:""}})],1)]):t._e(),0!==t.questions.length||t.loading?t._e():e(l["a"],[e(C["a"],{staticClass:"ma-2"},[e(_["d"],{staticClass:"headline"},[t._v("No questions here")]),e(_["b"],[t._v("Whoa! This is a quiet neighborhood. Be the first to ask a question.")]),e(_["a"],[e(r["a"],{attrs:{color:"orange",text:""}},[t._v("Ask question")])],1)],1)],1),t.questions.length>0?e(l["a"],{staticClass:"pa-0 ma-0"},t._l(t.questions,(function(t,s){return e(l["a"],{key:s,staticClass:"pa-0 ma-0"},[e("Question",{attrs:{question:t}})],1)})),1):t._e(),e(l["a"],{staticClass:"pa-0 ma-0"},[t.$auth.isAuthenticated?e(r["a"],{staticClass:"mb-4",attrs:{fixed:"",dark:"",fab:"",bottom:"",right:"",color:"red",to:"/ask"}},[e(u["a"],[t._v("add")])],1):t._e()],1)],1)},U=[],G=s("2f62"),W=s("169a"),H=s("ce7e"),N=s("1d4d"),V=function(){var t=this,e=t._self._c;return e(l["a"],{staticClass:"pa-0 ma-0"},[e(C["a"],{staticClass:"my-2 ma-2"},[e(_["c"],[e("div",{staticClass:"my-2 subtitle-1"},[t._v(t._s(t.question.question))]),"Star"===t.question.type?e("div",[e(N["a"],{attrs:{value:t.question.avgScore,color:"amber",dense:"","half-increments":"",readonly:"",size:"24"}}),t._v(" ("+t._s(t.question.answers)+" ratings) ")],1):t._e(),e("div",{staticClass:"my-4 subtitle-2"},[t._v(" Posted "),e("strong",[t._v(t._s(t.moment.unix(t.question.created/1e3).fromNow()))]),t.question.author===t.$store.getters.getUser.sub?e("strong",[t._v(" by you")]):t._e()])]),t.question.author!=t.$store.getters.getUser.sub?e(_["a"],["Star"===t.question.type?e("div",[e(r["a"],{attrs:{text:"",color:"orange",dark:""},on:{click:function(e){return t.openDialog(t.question)}}},[t._v(" Answer ")])],1):t._e(),"Geo"===t.question.type?e("div",[e(r["a"],{attrs:{text:"",color:"orange",dark:""},on:{click:function(e){return t.openMapDialog(t.question)}}},[t._v(" Answer on map ")]),e(r["a"],{attrs:{disabled:0===t.question.answers,text:"",color:"orange",dark:"",to:{name:"Answers",query:{hk:t.question.hashKey,rk:t.question.rangeKey}}}},[t._v(" See results ")])],1):t._e()]):t._e(),e(H["a"],{staticClass:"mx-4"})],1),e(W["a"],{attrs:{persistent:"","max-width":"290"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e(C["a"],[e(_["d"],{staticClass:"headline"},[t._v("Your rating:")]),e(_["c"],[e(N["a"],{attrs:{color:"amber",dense:"","half-increments":"",size:"40"},model:{value:t.starRating,callback:function(e){t.starRating=e},expression:"starRating"}})],1),e(_["a"],[e(h["a"]),e(r["a"],{attrs:{disabled:0===t.starRating||!0===t.saving,color:"success",text:""},on:{click:function(e){return t.submitDialog("star")}}},[t._v("Submit")]),e(r["a"],{attrs:{disabled:!0===t.saving,color:"error",text:""},on:{click:function(e){t.dialog=!1}}},[t._v("Cancel")])],1)],1)],1),e(W["a"],{attrs:{persistent:""},model:{value:t.mapDialog,callback:function(e){t.mapDialog=e},expression:"mapDialog"}},[e(C["a"],[e(_["d"],{staticClass:"headline"},[t._v("Drop a pin on your answer:")]),e(_["c"],[e("GmapMap",{ref:"gmap",staticStyle:{width:"100%",height:"400px"},attrs:{center:{lat:this.position.latitude,lng:this.position.longitude},zoom:7,"map-type-id":"roadmap",options:{zoomControl:!1,zoom:11,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUI:!1}}},[t._l(t.markers,(function(s,a){return e("GmapMarker",{key:a,attrs:{position:s.position},on:{click:function(e){t.center=s.position}}})})),e("GmapCircle",{attrs:{center:{lat:this.currentQuestion.latitude,lng:this.currentQuestion.longitude},radius:8e3,options:{fillColor:"blue",fillOpacity:.1,strokeColor:"#0000FF",strokeOpacity:.2,strokeWeight:5}},on:{click:t.addMarker}})],2)],1),e(_["a"],[e(h["a"]),e(r["a"],{attrs:{disabled:0===t.markers.length||!0===t.saving,color:"success",text:""},on:{click:function(e){return t.submitDialog("geo")}}},[t._v("Submit")]),e(r["a"],{attrs:{disabled:!0===t.saving,color:"error",text:""},on:{click:function(e){t.mapDialog=!1}}},[t._v("Cancel")])],1)],1)],1)],1)},E=[],F={name:"HomeView",props:["question"],data:function(){return{dialog:!1,mapDialog:!1,markers:[],starRating:0,saving:!1,currentQuestion:{latitude:40.7358235,longitude:-73.9927102}}},computed:{...Object(G["b"])({position:t=>t.position})},methods:{openDialog(t){console.log(t),this.currentQuestion=t,this.starRating=0,this.dialog=!0},openMapDialog(t){console.log(t),this.currentQuestion=t,this.markers=[],this.mapDialog=!0},addMarker(t){const e={lat:t.latLng.lat(),lng:t.latLng.lng()};this.markers.pop(),this.markers.push({position:e})},async submitDialog(t){console.log("submitDialog");const e=await this.$auth.getTokenSilently(),s=this.$APIurl+"/answers";this.saving=!0;let a={question:this.question,type:t};"star"===t?a.rating=this.starRating:(a.lat=this.markers[0].position.lat,a.lng=this.markers[0].position.lng),console.log("Payload: ",a);try{const{data:t}=await I.a.post(s,a,{headers:{Authorization:"Bearer "+e}});console.log("Result: ",t)}catch(o){console.error("Error: ",o)}this.dialog=!1,this.mapDialog=!1,this.saving=!1}}},J=F,B=Object(b["a"])(J,V,E,!1,null,null,null),X=B.exports,Y={name:"HomeView",components:{Question:X},data:function(){return{currentLat:40.7358235,currentLng:-73.9927102,loading:!0,user:null}},computed:{...Object(G["b"])(["questions"])},mounted(){console.log("mounted"),navigator.geolocation.getCurrentPosition(t=>{console.log("Position returned: ",t),this.$store.commit("setPosition",t),this.currentLat=t.coords.latitude,this.currentLng=t.coords.longitude,this.updateResults()},()=>{console.log("Error: The Geolocation service failed.")},{enableHighAccuracy:!0,timeout:3e4})},created(){Tt.$on("authenticated",async t=>{this.$store.commit("setUser",t),console.log("User signed in: ",this.$store.getters.getUser)})},methods:{async updateResults(){if(!this.$store.getters.isInitialized)return;const t=await this.$auth.getTokenSilently(),e=`${this.$APIurl}/questions?lat=${this.currentLat}&lng=${this.currentLng}`;console.log("URL: ",e);const{data:s}=await I.a.get(e,{headers:{Authorization:"Bearer "+t}});console.log("Response: ",s),this.$store.commit("setAllQuestions",s),this.loading=!1}}},Z=Y,tt=Object(b["a"])(Z,D,U,!1,null,null,null),et=tt.exports,st=function(){var t=this,e=t._self._c;return e(l["a"],{staticClass:"pa-0 ma-0"},[t.loading?e(l["a"],[e("div",{staticClass:"text-center"},[e(Q["a"],{attrs:{size:50,color:"orange",indeterminate:""}})],1)]):t._e(),t.loading?t._e():e(l["a"],{staticClass:"pa-0 ma-0",attrs:{id:"answersMap"}},[e("GmapMap",{staticStyle:{width:"100%",height:"80vh"},attrs:{center:{lat:this.currentLat,lng:this.currentLng},zoom:7,"map-type-id":"roadmap",options:{zoomControl:!0,zoom:11,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUI:!1}}},[t._l(t.blocks,(function(t,s){return e("GmapCircle",{key:s,attrs:{center:{lat:t.center.lat,lng:t.center.lng},radius:250+1500*t.pct,options:{fillColor:t.color,fillOpacity:.8,strokeColor:t.color,strokeOpacity:.8,strokeWeight:2}}})})),e("GmapCircle",{attrs:{center:{lat:t.currentLat,lng:t.currentLng},radius:8e3,options:{fillColor:"blue",fillOpacity:.1,strokeColor:"#0000FF",strokeOpacity:.2,strokeWeight:5}}})],2)],1),e(l["a"],{staticClass:"pa-0 ma-0"},[t.$auth.isAuthenticated?e(r["a"],{staticClass:"mb-4",attrs:{fixed:"",dark:"",fab:"",bottom:"",right:"",color:"gray",to:"/"}},[e(u["a"],[t._v("arrow_back")])],1):t._e()],1)],1)},at=[];const ot=s("e02a"),nt=["answers","totalScore","geohash","question","geoJson","hashKey","created","rangeKey","type","state","author"];var it={name:"Answers",components:{},data:function(){return{currentLat:40.7358235,parentHeight:600,currentLng:-73.9927102,loading:!0,hk:null,rk:null,blocks:[]}},async mounted(){console.log("mounted"),console.log(this.$route.query),this.hk=this.$route.query.hk,this.rk=this.$route.query.rk,this.parentHeight=this.$parent.$el.offsetHeight,this.hk&&this.rk&&await this.loadAnswers()},methods:{async loadAnswers(){console.log("loadAnswers called");const t=`${this.$APIurl}/geoQuestion?hk=${this.hk}&rk=${this.rk}`,e=await this.$auth.getTokenSilently();console.log("URL: ",t);const{data:s}=await I.a.get(t,{headers:{Authorization:"Bearer "+e}});console.log("Response: ",s);const a=JSON.parse(s.geoJson.S).coordinates;this.currentLng=a[0],this.currentLat=a[1],nt.map(t=>delete s[t]);let o=0;for(let i in s)o+=parseInt(s[i].N);function n(t){let e=240*(1-t);return`hsl(${e},100%,50%)`}for(let i in s)s[i].percent=s[i].N/o,s[i].color=n(s[i].percent);for(let i in s){const t=ot.decode_bbox(i);this.blocks.push({north:t[0],south:t[2],east:t[3],west:t[1],color:s[i].color,pct:s[i].percent,center:{lat:(t[0]+t[2])/2,lng:(t[1]+t[3])/2}})}this.loading=!1}}},rt=it,lt=Object(b["a"])(rt,st,at,!1,null,null,null),ct=lt.exports;a["a"].use(w["a"]);const ut=[{path:"/ask",name:"AskView",component:T},{path:"/",name:"HomeView",component:et},{path:"/answers",name:"Answers",component:ct}],dt=new w["a"]({mode:"history",base:"/",routes:ut});var ht=dt,gt=s("52dd"),pt=s.n(gt);a["a"].use(G["a"]);const ft=5,mt={initialized:!1,position:{latitude:"-70.8238872",longitude:"43.0385959"},hashKey:"",user:{},questions:[]},bt={isInitialized:t=>t.initialized,getPosition:t=>t.position,getUser:t=>t.user,getQuestions:t=>t.questions,getHashKey:t=>t.hashKey},yt={setPosition(t,e){t.position.latitude=e.coords.latitude,t.position.longitude=e.coords.longitude;const s=pt.a.getGeoHashCell(e.coords.latitude,e.coords.longitude,ft);t.hashKey=s},saveQuestion(t,e){console.log("store::saveQuestion:",e);for(let s in t.questions)if(console.log(t.questions[s]),t.questions[s].rangeKey===e.rangeKey)return console.log("Matched: ",e.rangeKey),t.questions[s].answers=e.answers,void(t.questions[s].avgScore=e.avgScore);console.log("Not in store - adding"),t.questions.push(e)},setUser(t,e){t.user=e},setHashKey(t,e){t.hashKey=e},setInitialized(t,e){console.log("setInitalized"),t.initialized=e},setAllQuestions(t,e){t.questions=e},updateQuestion(t,e){console.log("store::updateQuestion");for(let s in t.questions)t.questions[s].rangeKey===e.rangeKey&&(t.questions[s].answers=e.answers,t.questions[s].avgScore=e.avgScore,console.log("Updated question: ",t.questions[s].rangeKey))}};var jt=new G["a"].Store({state:mt,getters:bt,mutations:yt}),kt=function(){var t=this,e=t._self._c;return e("div")},vt=[];let wt;var Ct={name:"IoT",computed:{...Object(G["b"])({init:t=>t.initialized,hash:t=>t.hashKey})},watch:{init:function(){this.init&&(this.mountIOT(),console.log("Mounting websocket"))},hash:function(){console.log("IoT subscribing to ",this.hash),this.subscribe(this.hash)}},methods:{subscribe(t){console.log("IoT subcribing to ",t),wt.subscribe(t)},mountIOT(){let t=this.$store;const e=s("4a9d"),a=s("fefd");let o=0;const n={poolId:this.$poolId,host:this.$host,region:this.$region};var i="new-answer",r="askAroundMe-"+Math.floor(1e5*Math.random()+1);e.config.region=n.region,e.config.credentials=new e.CognitoIdentityCredentials({IdentityPoolId:n.poolId}),console.log("IoT created"),wt=a.device({region:e.config.region,host:n.host,clientId:r,protocol:"wss",maximumReconnectTimeMs:8e3,debug:!1,accessKeyId:"",secretKey:"",sessionToken:""});const l=new e.CognitoIdentity,c=function(){e.config.credentials.get((function(t,s){if(!t){console.log("retrieved identity: "+e.config.credentials.identityId,s);const t={IdentityId:e.config.credentials.identityId};l.getCredentialsForIdentity(t,(function(t,e){t||wt.updateWebSocketCredentials(e.Credentials.AccessKeyId,e.Credentials.SecretKey,e.Credentials.SessionToken)}))}}))};wt.on("connect",(function(){console.log("mqttClient connected"),wt.subscribe(i)})),wt.on("error",(function(t){o>0&&console.log("mqttClient error:",t),o++,c()})),wt.on("message",(function(e,s){const a=JSON.parse(s.toString());console.log("IoT msg: ",e,a),"new-answer"===e?(console.log("update"),t.commit("updateQuestion",a)):(console.log("New question"),t.commit("saveQuestion",a))}))}}},_t=Ct,qt=Object(b["a"])(_t,kt,vt,!1,null,null,null),$t=qt.exports,zt=s("c1df"),xt=s.n(zt),At=s("8160"),St=s("9767");const It=()=>window.history.replaceState({},document.title,window.location.pathname);let Ot;const Lt=({onRedirectCallback:t=It,redirectUri:e=window.location.origin,...s})=>Ot||(Ot=new a["a"]({data(){return{loading:!0,isAuthenticated:!1,user:{},auth0Client:null,popupOpen:!1,error:null}},methods:{async loginWithPopup(t){this.popupOpen=!0;try{await this.auth0Client.loginWithPopup(t)}catch(e){console.error(e)}finally{this.popupOpen=!1}this.user=await this.auth0Client.getUser(),this.isAuthenticated=!0},async handleRedirectCallback(){this.loading=!0;try{await this.auth0Client.handleRedirectCallback(),this.user=await this.auth0Client.getUser(),this.isAuthenticated=!0,Tt.$emit("authenticated",this.user)}catch(t){this.error=t}finally{Tt.$emit("loaded",!0),this.loading=!1}},loginWithRedirect(t){return this.auth0Client.loginWithRedirect(t)},getIdTokenClaims(t){return this.auth0Client.getIdTokenClaims(t)},getTokenSilently(t){return this.auth0Client.getTokenSilently(t)},getTokenWithPopup(t){return this.auth0Client.getTokenWithPopup(t)},logout(t){return this.auth0Client.logout(t)}},async created(){this.auth0Client=await Object(St["a"])({domain:s.domain,client_id:s.clientId,audience:s.audience,redirect_uri:e});try{if(window.location.search.includes("code=")&&window.location.search.includes("state=")){const{appState:e}=await this.auth0Client.handleRedirectCallback();t(e)}}catch(a){this.error=a}finally{this.isAuthenticated=await this.auth0Client.isAuthenticated(),this.user=await this.auth0Client.getUser(),this.loading=!1,Tt.$emit("authenticated",this.user),Tt.$emit("loaded",!0)}}}),Ot),Rt={install(t,e){t.prototype.$auth=Lt(e)}};a["a"].prototype.moment=xt.a,a["a"].component("iot",$t),a["a"].config.productionTip=!1,a["a"].prototype.$appName="Ask Around Me",a["a"].prototype.$GoogleMapsKey="AIzaSyD5rCYtdbXUbglPHkurVXRKviKje8gNza4",a["a"].prototype.$APIurl="https://75l6x2epq2.execute-api.eu-west-3.amazonaws.com",a["a"].prototype.$poolId="eu-west-3:37288420-1d6f-46ea-b416-dd79f9aebd57",a["a"].prototype.$host="auydp8x6g9rv-ats.iot.eu-west-3.amazonaws.com",a["a"].prototype.$region="eu-west-3",a["a"].use(o,{load:{key:a["a"].prototype.$GoogleMapsKey,libraries:"places"},installComponents:!0}),a["a"].use(Rt,{domain:At["c"],clientId:At["b"],audience:At["a"],onRedirectCallback:t=>{ht.push(t&&t.targetUrl?t.targetUrl:window.location.pathname)}});const Tt=new a["a"];new a["a"]({vuetify:v,router:ht,store:jt,render:t=>t(j)}).$mount("#app")},6:function(t,e){},7:function(t,e){},8:function(t,e){},8160:function(t){t.exports=JSON.parse('{"c":"<< Enter your value here e.g. dev-abc12345.auth0.com >>","b":"<< Enter your value here >>","a":"https://auth0-jwt-authorizer"}')},9:function(t,e){},d23c:function(t,e,s){t.exports=s.p+"img/ask-around-me-wide.1eea92ea.png"}});
//# sourceMappingURL=app.a3ee8fb3.js.map